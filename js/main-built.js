/*!art-template - Template Engine | http://aui.github.com/artTemplate/*/

define("control/Login",[],function(){var e={show:function(){$(".login").css({width:$("html").width()*.9+"px",height:$("html").height()*.9+"px",left:$("html").width()*.1/2+"px",top:$("html").height()*.1/2+"px",display:"block"}),document.body.clientWidth<=320&&$(".login").css({width:$("html").width(),left:"0px",top:"0px"})},hide:function(){$(".login").hide()},isLogin:function(){return 1},redirect:function(){window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxab18db1751df337d&redirect_uri=http%3A%2F%2F"+bed.wxCallback+"%2FLogin%2Fwx%3Fbeatid%3D"+bed.beatid+(bed.wxIsTest?"%26test%3D"+bed.wxIsTest:"")+"&response_type=code&scope=snsapi_userinfo&state=STATE&connect_redirect=1#wechat_redirect"+""},logined:function(){return e.getCookie("wxuid")?!0:!1},getCookie:function(e){if(document.cookie.length>0){c_start=document.cookie.indexOf(e+"=");if(c_start!=-1)return c_start=c_start+e.length+1,c_end=document.cookie.indexOf(";",c_start),c_end==-1&&(c_end=document.cookie.length),document.cookie.substring(c_start,c_end)}return""}};return e}),define("control/Reply",[],function(){var e={init:function(){$(".replyblock .send").click(e.sendHandler);if(Login.logined()){var t=$("#reply"),n=t[0].outerHTML;t[0].outerHTML=n.replace(/button/g,"textarea"),$("#reply").text("").removeAttr("placeholder").addClass("logined").attr("placeholder","回复 "+$(".self .detailup .nick").html())}else $("body").children().on("click focusin","button#reply",e.textAreaHandler);var r=new Image;r.src=bed.base+"/public/sharing/img/voice.png";var i=$(".switch").find("img")[0].src;$(".switch").on("click",function(){if(!$(this).hasClass("voice")){$(this).addClass("voice").find("img").get(0).src=r.src;var e=$(this).next("textarea"),t=e[0].outerHTML;e[0].outerHTML=t.replace(/textarea/g,"button"),$("#reply").text("点击回复"),Login.logined()?$("#reply").text("点击回复"):$("#reply").text("登陆后才能发语音")}else{$(this).removeClass("voice").find("img").get(0).src=i;if(Login.logined()){var e=$(this).next("button"),t=e[0].outerHTML;e[0].outerHTML=t.replace(/button/g,"textarea"),$("#reply").html("")}else $("#reply").text("登陆后才可回复")}}),$("body").children().on("click",".selfwrap",e.replyOneHandler),$("body").children().on("click",".contentup",e.replyOneHandler)},lastOneTarget:0,commentId:0,replyWidth:function(){$(".replyblock .reply textarea").css("width",$("html").width()-6-12-72-10+"px")},replyOneHandler:function(t){var n=this;e.commentId=$(n).data("comment-id")?$(n).data("comment-id"):0,console.log(t);if(!$(t.target).is("#bbtn")&&!$(t.target).is(".cbtn")&&!$(t.target).is(".c2btn")){if(!$(".replyblock").hasClass("replying")){if(Login.logined())$("#reply").attr("placeholder","回复 "+$(n).find(".nick").text());else{var r=$("#reply"),i=r[0].outerHTML;r[0].outerHTML=i.replace(/textarea/g,"button"),$("#reply").text("登陆后才可回复")}$(".replyblock").show(300).addClass("replying")}else e.lastOneTarget==t.target?$(".replyblock").hide(300).removeClass("replying"):Login.logined()&&$("#reply").attr("placeholder","回复 "+$(n).find(".nick").text());e.lastOneTarget=t.target}},sendHandler:function(t){console.log("send"),console.log(t),$.extend(bed.tmpData,{returncontent:$("#reply").val()+"",returnid:e.commentId,userid:bed.currUid,beatid:bed.beatid}),Login.logined()?$.ajax({type:"post",url:"//"+bed.serverURL+"/Put_comment/info",data:bed.tmpData,dataType:"json",async:!1,success:function(e){window.location.href=bed.base+"Sharing?beatid="+bed.beatid}}):Login.redirect()},textAreaHandler:function(){var e=this;Login.logined()||Login.redirect()},voiceInit:function(){$("body").children().on("click","button#reply",e.voiceHandler)},voiceHandler:function(){var t=this;$(".switch").hasClass("voice")&&(Login.logined()?$(t).hasClass("recording")?($(t).text("点击回复").removeClass("recording"),wx.stopRecord({success:function(t){var n=t.localId;wx.uploadVoice({localId:n,isShowProgressTips:1,success:function(t){var n=t.serverId;$.extend(bed.tmpData,{returntype:"1",returnid:e.commentId,userid:bed.currUid,beatid:bed.beatid,amrid:n}),$.post(bed.base+"Upload/wxAmr",bed.tmpData,function(e){window.location.href=bed.base+"Sharing?beatid="+bed.beatid},"json")}})}})):(wx.startRecord(),$(t).text("录制中").addClass("recording")):Login.redirect())}};return e}),function(e,t){var n={formatDate:function(e){var t=new Date(+e),n=t.getFullYear(),r=t.getMonth()+1,i=t.getDate(),s=t.getHours(),o=t.getMinutes(),u=t.getSeconds();return u<=9&&(u="0"+u),n+"-"+r+"-"+i+" "+s+":"+o+":"+u},serverURL:"www.shuiqian.cc",wxCallback:"m.shuiqian.cc",wxIsTest:"",beatURL:"7xkfix.dl1.z0.glb.clouddn.com",userURL:"7xjfap.dl1.z0.glb.clouddn.com",commentURL:"7xkfiz.dl1.z0.glb.clouddn.com",templateConfig:function(e){e.config("openTag","{{"),e.config("closeTag","}}"),e.config("escape",!1)}};e.location.href.indexOf("test.shuiqian.cc")>=0&&(n.serverURL="test.shuiqian.cc"),e.location.href.indexOf("mtest.shuiqian.cc")>=0&&(n.serverURL="test.shuiqian.cc"),typeof module=="object"&&module&&typeof module.exports=="object"?module.exports=n:typeof define=="function"&&define.amd?define("bedtime",[],function(){return typeof bed!="undefined"?$.extend(bed,n):n}):typeof bed!="undefined"?$.extend(bed,n):e.bed=n}(window,undefined),define("control/Weixin",["bedtime","wx"],function(e,t){var n={init:function(){console.log(e),t.config(e.weixin.config),t.ready(function(){Reply.voiceInit(),t.onMenuShareTimeline({title:$("title").html()+"",link:window.location.href+"",imgUrl:"http://mtest.shuiqian.cc/public/sharing/img/logo.png?3",success:function(){},cancel:function(){}}),t.onMenuShareAppMessage({title:$("title").html()+"",desc:"睡前的你不再孤单",link:window.location.href+"",imgUrl:"http://mtest.shuiqian.cc/public/sharing/img/logo.png?3",type:"link",dataUrl:"",success:function(){},cancel:function(){}})})},testMedia:function(){function e(){return!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)}e()?alert("您的浏览器支持getUserMedia方法"):alert("您的浏览器不支持getUserMedia方法")}};return n}),function(e){"use strict";var t=e.Base64,n="2.1.7",r;typeof module!="undefined"&&module.exports&&(r=require("buffer").Buffer);var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=function(e){var t={};for(var n=0,r=e.length;n<r;n++)t[e.charAt(n)]=n;return t}(i),o=String.fromCharCode,u=function(e){if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?o(192|t>>>6)+o(128|t&63):o(224|t>>>12&15)+o(128|t>>>6&63)+o(128|t&63)}var t=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return o(240|t>>>18&7)+o(128|t>>>12&63)+o(128|t>>>6&63)+o(128|t&63)},a=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,f=function(e){return e.replace(a,u)},l=function(e){var t=[0,2,1][e.length%3],n=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0),r=[i.charAt(n>>>18),i.charAt(n>>>12&63),t>=2?"=":i.charAt(n>>>6&63),t>=1?"=":i.charAt(n&63)];return r.join("")},c=e.btoa?function(t){return e.btoa(t)}:function(e){return e.replace(/[\s\S]{1,3}/g,l)},h=r?function(e){return(e.constructor===r.constructor?e:new r(e)).toString("base64")}:function(e){return c(f(e))},p=function(e,t){return t?h(String(e)).replace(/[+\/]/g,function(e){return e=="+"?"-":"_"}).replace(/=/g,""):h(String(e))},d=function(e){return p(e,!0)},v=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),m=function(e){switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),n=t-65536;return o((n>>>10)+55296)+o((n&1023)+56320);case 3:return o((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return o((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},g=function(e){return e.replace(v,m)},y=function(e){var t=e.length,n=t%4,r=(t>0?s[e.charAt(0)]<<18:0)|(t>1?s[e.charAt(1)]<<12:0)|(t>2?s[e.charAt(2)]<<6:0)|(t>3?s[e.charAt(3)]:0),i=[o(r>>>16),o(r>>>8&255),o(r&255)];return i.length-=[0,0,2,1][n],i.join("")},b=e.atob?function(t){return e.atob(t)}:function(e){return e.replace(/[\s\S]{1,4}/g,y)},w=r?function(e){return(e.constructor===r.constructor?e:new r(e,"base64")).toString()}:function(e){return g(b(e))},E=function(e){return w(String(e).replace(/[-_]/g,function(e){return e=="-"?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},S=function(){var n=e.Base64;return e.Base64=t,n};e.Base64={VERSION:n,atob:b,btoa:c,fromBase64:E,toBase64:p,utob:f,encode:p,encodeURI:d,btou:g,decode:E,noConflict:S};if(typeof Object.defineProperty=="function"){var x=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}};e.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",x(function(){return E(this)})),Object.defineProperty(String.prototype,"toBase64",x(function(e){return p(this,e)})),Object.defineProperty(String.prototype,"toBase64URI",x(function(){return p(this,!0)}))}}}(this),this.Meteor&&(Base64=global.Base64),define("base64",function(e){return function(){var t,n;return t||e.Base64}}(this)),!function(){function e(e){return e.replace(b,"").replace(w,",").replace(E,"").replace(S,"").replace(x,"").split(T)}function t(e){return"'"+e.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")+"'"}function n(n,r){function i(e){return h+=e.split(/\n/).length-1,l&&(e=e.replace(/\s+/g," ").replace(/<!--[\w\W]*?-->/g,"")),e&&(e=y[1]+t(e)+y[2]+"\n"),e}function s(t){var n=h;if(f?t=f(t,r):o&&(t=t.replace(/\n/g,function(){return h++,"$line="+h+";"})),0===t.indexOf("=")){var i=c&&!/^=[=#]/.test(t);if(t=t.replace(/^=[=#]?|[\s;]*$/g,""),i){var s=t.replace(/\s*\([^\)]+\)/,"");p[s]||/^(include|print)$/.test(s)||(t="$escape("+t+")")}else t="$string("+t+")";t=y[1]+t+y[2]}return o&&(t="$line="+n+";"+t),g(e(t),function(e){if(e&&!v[e]){var t;t="print"===e?w:"include"===e?E:p[e]?"$utils."+e:d[e]?"$helpers."+e:"$data."+e,S+=e+"="+t+",",v[e]=!0}}),t+"\n"}var o=r.debug,u=r.openTag,a=r.closeTag,f=r.parser,l=r.compress,c=r.escape,h=1,v={$data:1,$filename:1,$utils:1,$helpers:1,$out:1,$line:1},m="".trim,y=m?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");","$out.join('')"],b=m?"$out+=text;return $out;":"$out.push(text);",w="function(){var text=''.concat.apply('',arguments);"+b+"}",E="function(filename,data){data=data||$data;var text=$utils.$include(filename,data,$filename);"+b+"}",S="'use strict';var $utils=this,$helpers=$utils.$helpers,"+(o?"$line=0,":""),x=y[0],T="return new String("+y[3]+");";g(n.split(u),function(e){e=e.split(a);var t=e[0],n=e[1];1===e.length?x+=i(t):(x+=s(t),n&&(x+=i(n)))});var N=S+x+T;o&&(N="try{"+N+"}catch(e){throw {filename:$filename,name:'Render Error',message:e.message,line:$line,source:"+t(n)+".split(/\\n/)[$line-1].replace(/^\\s+/,'')};}");try{var C=new Function("$data","$filename",N);return C.prototype=p,C}catch(k){throw k.temp="function anonymous($data,$filename) {"+N+"}",k}}var r=function(e,t){return"string"==typeof t?m(t,{filename:e}):o(e,t)};r.version="3.0.0",r.config=function(e,t){i[e]=t};var i=r.defaults={openTag:"<%",closeTag:"%>",escape:!0,cache:!0,compress:!1,parser:null},s=r.cache={};r.render=function(e,t){return m(e,t)};var o=r.renderFile=function(e,t){var n=r.get(e)||v({filename:e,name:"Render Error",message:"Template not found"});return t?n(t):n};r.get=function(e){var t;if(s[e])t=s[e];else if("object"==typeof document){var n=document.getElementById(e);if(n){var r=(n.value||n.innerHTML).replace(/^\s*|\s*$/g,"");t=m(r,{filename:e})}}return t};var u=function(e,t){return"string"!=typeof e&&(t=typeof e,"number"===t?e+="":e="function"===t?u(e.call(e)):""),e},a={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},f=function(e){return a[e]},l=function(e){return u(e).replace(/&(?![\w#]+;)|[<>"']/g,f)},c=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},h=function(e,t){var n,r;if(c(e))for(n=0,r=e.length;r>n;n++)t.call(e,e[n],n,e);else for(n in e)t.call(e,e[n],n)},p=r.utils={$helpers:{},$include:o,$string:u,$escape:l,$each:h};r.helper=function(e,t){d[e]=t};var d=r.helpers=p.$helpers;r.onerror=function(e){var t="Template Error\n\n";for(var n in e)t+="<"+n+">\n"+e[n]+"\n\n";"object"==typeof console&&console.error(t)};var v=function(e){return r.onerror(e),function(){return"{Template Error}"}},m=r.compile=function(e,t){function r(n){try{return new a(n,u)+""}catch(r){return t.debug?v(r)():(t.debug=!0,m(e,t)(n))}}t=t||{};for(var o in i)void 0===t[o]&&(t[o]=i[o]);var u=t.filename;try{var a=n(e,t)}catch(f){return f.filename=u||"anonymous",f.name="Syntax Error",v(f)}return r.prototype=a.prototype,r.toString=function(){return a.toString()},u&&t.cache&&(s[u]=r),r},g=p.$each,y="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",b=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|\s*\.\s*[$\w\.]+/g,w=/[^\w$]+/g,E=new RegExp(["\\b"+y.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),S=/^\d[^,]*|,\d[^,]*/g,x=/^,+|,+$/g,T=/^$|,+/;"function"==typeof define?define("template",[],function(){return r}):"undefined"!=typeof exports?module.exports=r:this.template=r}(),define("control/Sharing",["bedtime","base64","template"],function(e,t,n){e.templateConfig(n);var r=function(){jQuery(function(r){function f(u){i="userid="+e.currUserId+"&beatid="+e.beatid+"&page="+u,s=t.encode(i),r.ajax({type:"post",url:"//"+e.serverURL+"/Get_beatcomments_mp3/info?data="+s,dataType:"json",async:!1,beforeSend:function(){r(".others").append("<div id='loading' style='position: absolute;bottom: 0'>加载中，请稍等</div>")},success:function(t){t.bed=e;var i=n("otherstmpl",t);r(".others").append(i),l(),o=t.code,r(".others #loading").remove(),g(),y()}})}function l(){r(".others .otherswrap").width(parseInt(r(".others").width()*.95)),r(".others .contentwrap").width(r(".others .otherswrap").width()-r(".others .headpic").width())}function g(){if(r("audio.playing")[0]){var e=r("audio.playing")[0];e.pause(),e.currentTime=0}var t=r(".cbtn");t.off("click"),t.click(function(){if(r("audio.playing")[0]){var e=r("audio.playing")[0];e.pause(),e.currentTime=0}var t=this,n=r(this).next("audio")[0];r(n).hasClass("playing")||(p=t.src,t.src=v.src,n.play(),r(n).addClass("playing")),r(n).off("ended pause"),r(n).on("ended pause",function(){r(n).removeClass("playing"),t.src=p})})}function y(){var e=r(".c2btn");e.off("click"),e.click(function(){if(r("audio.playing")[0]){var e=r("audio.playing")[0];e.pause(),e.currentTime=0}var t=this,n=r(this).next("audio")[0];r(n).hasClass("playing")||(d=t.src,t.src=m.src,n.play(),r(n).addClass("playing")),r(n).off("ended pause"),r(n).on("ended pause",function(){r(n).removeClass("playing"),t.src=d})})}function b(){var t=window.navigator.userAgent,n=new Date,r=n.getFullYear(),i=n.getMonth()+1,s=n.getDate();t.indexOf("Android")>=0?window.location.href="http://"+e.serverURL+"/Download/":t.indexOf("iPhone")>=0?alert("正在开发中"):t.indexOf("iPad")>=0?alert("正在开发中"):alert("抱歉，暂不支持您的手机系统！")}console.log(e),r(".download").click(b),l(),r(window).resize(l),r.ajax({type:"post",url:"//"+e.serverURL+"/Get_beatinfo_mp3/info",data:{userid:e.currUserId,beatid:e.beatid},dataType:"json",success:function(t){var i=t.info;i.bed=e;var s=n("selftmpl",i);console.log(s),r(".self").html(s),i.sex==1?r(".self .sexage").css("background-image","url("+e.base+"public/sharing/img/boy.png)"):i.sex==2&&r(".self .sexage").css("background-image","url("+e.base+"public/sharing/img/girl.png)"),r("title").html(i.title);var o=new Image;o.src=""+e.base+"public/sharing/img/playl.gif?1",r("#bbtn").off("click"),r("#bbtn").click(function(){if(r("audio.playing")[0]){var e=r("audio.playing")[0];e.pause(),e.currentTime=0}var t=this,n=r(this).next("audio")[0];r(n).hasClass("playing")||(h=t.src,t.src=o.src,n.play(),r(n).addClass("playing")),r(n).off("ended pause"),r(n).on("ended pause",function(){r(n).removeClass("playing"),t.src=h})})}});var i="userid="+e.currUserId+"&beatid="+e.beatid+"&page=1",s=t.encode(i),o=1704;r.ajax({type:"post",url:"//"+e.serverURL+"/Get_beatcomments_mp3/info?data="+s,dataType:"json",success:function(t){t.bed=e;var i=n("otherstmpl",t);r(".others").html(i),l(),g(),y(),r("body").children().on("click",".cmtmore",b),t.code==1704&&r(window).scroll(function(){var e=document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop;u()-r(window).height()-e<200&&o==1704?(f(a),a+=1):u()-r(window).height()-e>=200})}});var u=function(){return r(".otherswrap:last").offset().top},a=2,c=function(e){},h,p,d,v=new Image;v.src=""+e.base+"public/sharing/img/plays.gif?2";var m=new Image;m.src=""+e.base+"public/sharing/img/plays.gif?2"})},i={init:r};return i}),requirejs.config({paths:{bedtime:"./config/bedtime",wx:"//res.wx.qq.com/open/js/jweixin-1.0.0",base64:"./thirdparty/base64.min",template:"./thirdparty/template-native"},shim:{base64:{exports:"Base64"}}}),require(["wx","control/Login","control/Reply","control/Weixin","control/Sharing"],function(e,t,n,r,i){i.init(),r.init()}),define("main",function(){});